{
  "swagger" : "2.0",
  "info" : {
    "version" : "v1",
    "title" : "KS Fiks: Innsyn Index Service",
    "contact" : {
      "name" : "Fiks brukerstøtte",
      "url" : "http://www.ks.no/fagomrader/utvikling/digitalisering/digitaliseringsstrategien/fiks/",
      "email" : "fiks@ks.no"
    }
  },
  "host" : "api.fiks.test.ks.no",
  "basePath" : "/",
  "tags" : [ {
    "name" : "Index"
  } ],
  "schemes" : [ "https" ],
  "paths" : {
    "/innsyn-index/api/v1/indexRequest" : {
      "put" : {
        "tags" : [ "Index" ],
        "summary" : "Indekser nye meldinger, eller oppdater eksisterende meldinger",
        "description" : "Batch av en eller flere meldinger, opp til et maksimum av 5000. Merk at operasjonen ikke er atomisk: responsen vil indikere om en eller flere indekseringsoperasjoner feilet.",
        "operationId" : "index",
        "parameters" : [ {
          "in" : "body",
          "name" : "body",
          "description" : "Meldingene som skal indekseres",
          "required" : false,
          "schema" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/definitions/IndexMeldingV1"
            }
          }
        } ],
        "responses" : {
          "200" : {
            "description" : "Indekseringsoperasjonen er gjennomført. Merk at indekseringen av en eller flere meldinger kan ha feilet, se de individuelle respons-kodene.",
            "schema" : {
              "$ref" : "#/definitions/MeldingIndexResponse"
            }
          },
          "400" : {
            "description" : "Forespørselen er ikke korrekt formatert",
            "schema" : {
              "type" : "array",
              "items" : {
                "$ref" : "#/definitions/Valdieringsfeil"
              }
            }
          },
          "403" : {
            "description" : "Integrasjonen er ikke autorisert for å indeksere på vegne av spesifisert organisasjon",
            "schema" : {
              "$ref" : "#/definitions/IntegrasjonIkkeAutorisertForIndexApiModel"
            }
          },
          "422" : {
            "description" : "Antall meldinger i operasjonen overgår øvre begrensning (5000)"
          },
          "500" : {
            "description" : "Indekseringsoperasjonen har feilet. Et ukjent antall meldinger kan likevel ha blitt indeksert, men alle bør sendes inn på nytt"
          }
        }
      }
    },
    "/innsyn-index/api/v1/slett" : {
      "delete" : {
        "tags" : [ "Index" ],
        "summary" : "Fjerner meldinger for den spesifiserte integrasjon/fiks-org. Enhet eller meldingsid kan legges til for ytterligere filtrering.",
        "description" : "",
        "operationId" : "slett",
        "parameters" : [ {
          "name" : "fiksOrganisasjonId",
          "in" : "query",
          "description" : "Fiks-organisasjon id",
          "required" : true,
          "type" : "string",
          "format" : "uuid"
        }, {
          "name" : "eksternRef",
          "in" : "query",
          "description" : "Ekstern referanse",
          "required" : false,
          "type" : "string"
        }, {
          "name" : "meldingId",
          "in" : "query",
          "description" : "Gruppe id",
          "required" : false,
          "type" : "string",
          "format" : "uuid"
        } ],
        "responses" : {
          "200" : {
            "description" : "successful operation",
            "schema" : {
              "$ref" : "#/definitions/SlettRespons"
            }
          }
        }
      }
    }
  },
  "definitions" : {
    "ByggesakDokumentTypeV1" : {
      "type" : "object",
      "required" : [ "kodebeskrivelse", "kodeverdi" ],
      "properties" : {
        "kodeverdi" : {
          "type" : "string"
        },
        "kodebeskrivelse" : {
          "type" : "string"
        }
      }
    },
    "ByggesakDokumentV1" : {
      "type" : "object",
      "required" : [ "dokumentsdato", "dokumenttype", "erstatterTidligereSystemId", "mimeType", "nedlastingslenke", "size", "systemId", "tittel", "vedtaksdato", "vedtaksstatus", "versjon" ],
      "properties" : {
        "tittel" : {
          "type" : "string",
          "description" : "Beskrivende tittel på dokumentet"
        },
        "dokumenttype" : {
          "$ref" : "#/definitions/ByggesakDokumentTypeV1"
        },
        "nedlastingslenke" : {
          "type" : "string",
          "description" : "Referanse til dokument med uri"
        },
        "dokumentsdato" : {
          "type" : "integer",
          "format" : "int64",
          "description" : "Dato som er påført selve dokumentet.  Uttrykket som millisekunder etter epoch"
        },
        "vedtaksstatus" : {
          "type" : "string"
        },
        "vedtaksdato" : {
          "type" : "integer",
          "format" : "int64"
        },
        "versjon" : {
          "type" : "string"
        },
        "systemId" : {
          "type" : "string"
        },
        "erstatterTidligereSystemId" : {
          "type" : "string"
        },
        "size" : {
          "type" : "integer",
          "format" : "int32"
        },
        "mimeType" : {
          "type" : "string"
        }
      }
    },
    "EksponertFor" : {
      "type" : "object",
      "properties" : {
        "identifikatorType" : {
          "type" : "string",
          "description" : "Type identifikator",
          "enum" : [ "ORGANISASJONSNUMMER", "FODSELSNUMMER", "MATRIKKELNUMMER" ]
        },
        "verdi" : {
          "type" : "string",
          "description" : "Et 11 siffret fødselsnummer, et 9 siffret organisasjonsnummer, eller et matrikkelnummer på format <kommunenr>-<gardsnr>/<bruksnr>/<festenr>/<seksjonsnr>"
        }
      },
      "description" : "Anngir hvem som skal ha tilgang til dokumentet. Dette kan endten være en fysisk person, en organisasjon, eller en matrikkelenhet."
    },
    "Forelder" : {
      "type" : "object",
      "required" : [ "meldingId", "type" ],
      "properties" : {
        "meldingId" : {
          "type" : "string",
          "format" : "uuid"
        },
        "type" : {
          "type" : "string",
          "enum" : [ "faktura", "saksmappe", "journalpost", "byggesak", "forsendelse", "matrikkelenhet" ]
        }
      },
      "description" : "Spesifiser et foreldre-dokument."
    },
    "ForsendelseV1Dokument" : {
      "type" : "object",
      "required" : [ "nedlastingLenke", "tittel" ],
      "properties" : {
        "tittel" : {
          "type" : "string",
          "description" : "Tittel for dokumentet"
        },
        "size" : {
          "type" : "integer",
          "format" : "int32",
          "description" : "Dokumentets størrelse i bytes"
        },
        "nedlastingLenke" : {
          "type" : "string",
          "description" : "Url for nedlasting av dokumentet"
        }
      },
      "description" : "Et dokument for en forsendelse"
    },
    "ForsendelseV2Adresse" : {
      "type" : "object",
      "required" : [ "navn" ],
      "properties" : {
        "navn" : {
          "type" : "string",
          "description" : "Navn"
        },
        "addresselinje1" : {
          "type" : "string",
          "description" : "Første adresselinje"
        },
        "addresselinje2" : {
          "type" : "string",
          "description" : "Andre adresselinje"
        },
        "addresselinje3" : {
          "type" : "string",
          "description" : "Tredje adresselinje"
        },
        "poststed" : {
          "type" : "string",
          "description" : "Poststed"
        },
        "postnummer" : {
          "type" : "string",
          "description" : "Postnummer"
        },
        "land" : {
          "type" : "string",
          "description" : "Land"
        }
      },
      "description" : "Representerer en postadresse i en forsendelse"
    },
    "ForsendelseV2Dokument" : {
      "type" : "object",
      "required" : [ "mimeType", "nedlastingLenke", "tittel" ],
      "properties" : {
        "tittel" : {
          "type" : "string",
          "description" : "Tittel for dokumentet"
        },
        "size" : {
          "type" : "integer",
          "format" : "int32",
          "description" : "Dokumentets størrelse i bytes"
        },
        "nedlastingLenke" : {
          "type" : "string",
          "description" : "Url for nedlasting av dokumentet"
        },
        "mimeType" : {
          "type" : "string",
          "description" : "Mime-type for dokumentet lenken leder til"
        }
      },
      "description" : "Reprensenterer et dokument i en forsendelse"
    },
    "ForsendelseV2Lenke" : {
      "type" : "object",
      "properties" : {
        "url" : {
          "type" : "string",
          "description" : "Url for lenken"
        },
        "urlTekst" : {
          "type" : "string",
          "description" : "Tekst som skal benyttes for url"
        },
        "ledetekst" : {
          "type" : "string",
          "description" : "Ledetekst for lenken"
        }
      },
      "description" : "Representerer en postadresse i en forsendelse"
    },
    "IndexMeldingV1" : {
      "type" : "object",
      "required" : [ "eksponertFor", "fiksOrganisasjonId", "meldingId", "meldingMetadata", "sikkerhetsniva" ],
      "properties" : {
        "meldingId" : {
          "type" : "string",
          "format" : "uuid",
          "example" : "b8403bc6-4a82-4fee-b06f-8893a539c453"
        },
        "sikkerhetsniva" : {
          "type" : "integer",
          "format" : "int32",
          "example" : 4,
          "minimum" : 0
        },
        "eksponertFor" : {
          "example" : "123456789",
          "$ref" : "#/definitions/EksponertFor"
        },
        "fiksOrganisasjonId" : {
          "type" : "string",
          "format" : "uuid",
          "example" : "120b7806-611f-4b76-b2d4-3a1445de5281"
        },
        "eksternRef" : {
          "type" : "string",
          "example" : "sakogarkiv.byggesak",
          "pattern" : "^[A-Za-zæøåÆØÅ0-9_.,/\\-_ ]+$"
        },
        "meldingMetadata" : {
          "$ref" : "#/definitions/MeldingMetadata"
        }
      },
      "description" : "En forespørsel om å opprette en ny eller oppdatere eksisterende melding"
    },
    "IntegrasjonIkkeAutorisertForIndexApiModel" : {
      "type" : "object",
      "properties" : {
        "integrasjonId" : {
          "type" : "string",
          "format" : "uuid"
        },
        "fiksOrgId" : {
          "type" : "string",
          "format" : "uuid"
        }
      }
    },
    "JournalpostV1Dokumentbeskrivelse" : {
      "type" : "object",
      "required" : [ "filstorrelse", "nedlastingLenke", "tittel", "variantformat" ],
      "properties" : {
        "tittel" : {
          "type" : "string"
        },
        "filstorrelse" : {
          "type" : "integer",
          "format" : "int32"
        },
        "variantformat" : {
          "type" : "string"
        },
        "nedlastingLenke" : {
          "type" : "string"
        }
      },
      "description" : "Et dokument for en forsendelse"
    },
    "MatrikkelnummerV1" : {
      "type" : "object",
      "required" : [ "bruksnummer", "festenummer", "gardsnummer", "kommunenummer", "seksjonsnummer" ],
      "properties" : {
        "kommunenummer" : {
          "type" : "string",
          "pattern" : "^\\d{4}$"
        },
        "gardsnummer" : {
          "type" : "string",
          "pattern" : "^[0-9]{1,6}$"
        },
        "bruksnummer" : {
          "type" : "string",
          "pattern" : "^[0-9]{1,6}$"
        },
        "festenummer" : {
          "type" : "string",
          "pattern" : "^[0-9]{1,6}$"
        },
        "seksjonsnummer" : {
          "type" : "string",
          "pattern" : "^[0-9]{1,6}$"
        }
      }
    },
    "MeldingIndexResponse" : {
      "type" : "object",
      "required" : [ "manglerSamtykke", "oppdatert", "opprettet" ],
      "properties" : {
        "opprettet" : {
          "type" : "integer",
          "format" : "int32"
        },
        "oppdatert" : {
          "type" : "integer",
          "format" : "int32"
        },
        "manglerSamtykke" : {
          "type" : "integer",
          "format" : "int32"
        },
        "meldingerUtenSamtykke" : {
          "type" : "array",
          "items" : {
            "type" : "string",
            "format" : "uuid"
          }
        }
      },
      "description" : "Resultat av indekseringsforespørselen"
    },
    "MeldingMetadata" : {
      "type" : "object",
      "required" : [ "versjon" ],
      "discriminator" : "versjon",
      "properties" : {
        "versjon" : {
          "type" : "string",
          "enum" : [ "fakturaV1", "saksmappeV1", "journalpostV1", "forsendelseV1", "forsendelseV2", "byggesakV1", "matrikkelenhetV1" ]
        }
      }
    },
    "SaksnummerV1" : {
      "type" : "object",
      "required" : [ "saksaar", "sakssekvensnummer" ],
      "properties" : {
        "saksaar" : {
          "type" : "string"
        },
        "sakssekvensnummer" : {
          "type" : "string"
        }
      }
    },
    "SlettRespons" : {
      "type" : "object",
      "properties" : {
        "antallSlettet" : {
          "type" : "integer",
          "format" : "int64",
          "description" : "Antall meldinger som ble slettet i operasjonen."
        }
      }
    },
    "TiltakstypeV1" : {
      "type" : "object",
      "properties" : {
        "kodeverdi" : {
          "type" : "string"
        },
        "kodebeskrivelse" : {
          "type" : "string"
        }
      }
    },
    "Valdieringsfeil" : {
      "type" : "object",
      "properties" : {
        "meldingId" : {
          "type" : "string",
          "format" : "uuid",
          "description" : "Id for meldingen som ikke kunne valideres"
        },
        "felt" : {
          "type" : "string",
          "description" : "Feltet som feiler"
        },
        "feilmelding" : {
          "type" : "string",
          "description" : "Beskrivelse av feilen som oppstod"
        }
      }
    },
    "byggesakV1" : {
      "allOf" : [ {
        "$ref" : "#/definitions/MeldingMetadata"
      }, {
        "type" : "object",
        "required" : [ "dokumentlistebeskrivelse", "saksdato", "tittel" ],
        "properties" : {
          "tittel" : {
            "type" : "string",
            "description" : "Tittel for byggesaken"
          },
          "beskrivelse" : {
            "type" : "string",
            "description" : "Beskrivelse av byggesaken"
          },
          "mappeId" : {
            "type" : "string"
          },
          "sakstatus" : {
            "type" : "string"
          },
          "saksdato" : {
            "type" : "integer",
            "format" : "int64",
            "example" : 1527140551605,
            "description" : "Datoen saken er opprettet. Uttrykket som millisekunder etter epoch"
          },
          "saksansvarlig" : {
            "type" : "string",
            "example" : "Ola Normann",
            "description" : "Saksbehandler som er ansvarlig for saken"
          },
          "administrativEnhet" : {
            "type" : "string",
            "description" : "Avdeling, team eller etat som behandler saken"
          },
          "adresse" : {
            "type" : "string",
            "example" : "Øvre Eksempelveien 35, 5073 BERGEN",
            "description" : "Adresse til tiltaket"
          },
          "avsluttetDato" : {
            "type" : "integer",
            "format" : "int64",
            "example" : 1527140551605,
            "description" : "Dato hvor saken er avsluttet"
          },
          "saksnummer" : {
            "$ref" : "#/definitions/SaksnummerV1"
          },
          "tiltakstype" : {
            "description" : "ref kodeliste https://register.geonorge.no/byggesoknad/tiltaktype",
            "$ref" : "#/definitions/TiltakstypeV1"
          },
          "tiltakshaver" : {
            "type" : "string",
            "description" : "Navn på tiltakshaver. Tiltakshaver er eier av søknaden og har et overordnet ansvar for det som bygges"
          },
          "ansvarligSoker" : {
            "type" : "string",
            "description" : "Navn på ansvarlig søker. Ansvarlig søker har påtatt seg ansvaret for byggesøknaden og all kommunikasjon med kommunens byggesaksavdeling"
          },
          "matrikkelnummer" : {
            "$ref" : "#/definitions/MatrikkelnummerV1"
          },
          "dokumentlistebeskrivelse" : {
            "type" : "string",
            "description" : "En beskrivelse av hva dokumentlisten inneholder. Feks om det er utvalge dokumenter i en sak eller alle dokumenter"
          },
          "dokumenter" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/definitions/ByggesakDokumentV1"
            }
          },
          "korrelasjonId" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9\\-]+$"
          },
          "forelder" : {
            "$ref" : "#/definitions/Forelder"
          }
        },
        "description" : "Byggesak"
      } ]
    },
    "fakturaV1" : {
      "allOf" : [ {
        "$ref" : "#/definitions/MeldingMetadata"
      }, {
        "type" : "object",
        "required" : [ "fakturaDato", "forfallDato", "tittel" ],
        "properties" : {
          "tittel" : {
            "type" : "string",
            "example" : "Parkeringsgebyr 11.05.18",
            "description" : "Tittel for fakturaen"
          },
          "fakturaDato" : {
            "type" : "integer",
            "format" : "int64",
            "example" : 1527140551605,
            "description" : "Dato fakturaen er sendt. Dette feltet brukes som sorteringsdato. Uttrykket som millisekunder etter epoch"
          },
          "forfallDato" : {
            "type" : "integer",
            "format" : "int64"
          },
          "fakturaMottaker" : {
            "type" : "string"
          },
          "betalesTil" : {
            "type" : "string"
          },
          "korrelasjonId" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9\\-]+$"
          },
          "forelder" : {
            "$ref" : "#/definitions/Forelder"
          },
          "belop" : {
            "type" : "string"
          }
        },
        "description" : "Hendelse som beskriver en forsendelse"
      } ]
    },
    "forsendelseV1" : {
      "allOf" : [ {
        "$ref" : "#/definitions/MeldingMetadata"
      }, {
        "type" : "object",
        "required" : [ "avsender", "dokumenter", "lest", "mottaker", "sendtDato", "tittel" ],
        "properties" : {
          "tittel" : {
            "type" : "string",
            "description" : "Tittel for meldingen"
          },
          "sendtDato" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "Dato forsendelsen er sendt. Dette feltet brukes som sorteringsdato. Uttrykket som millisekunder etter epoch"
          },
          "avsender" : {
            "type" : "string",
            "description" : "Navn på person eller orgnr / navn på organisasjon som er kilde for forsendelsen."
          },
          "mottaker" : {
            "type" : "string",
            "description" : "Navn på person eller orgnr / navn på organisasjon som er mottaker for forsendelsen"
          },
          "lest" : {
            "type" : "boolean",
            "description" : "Indikerer om forsendelsen er lest eller ikke"
          },
          "svarLenke" : {
            "type" : "string",
            "description" : "Url som skal benyttes for å svare på denne forsendelsen"
          },
          "korrelasjonId" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9\\-]+$"
          },
          "forelder" : {
            "$ref" : "#/definitions/Forelder"
          },
          "dokumenter" : {
            "type" : "array",
            "description" : "Dokumenter som inngår i denne forsendelsen",
            "items" : {
              "$ref" : "#/definitions/ForsendelseV1Dokument"
            },
            "maxItems" : 2147483647,
            "minItems" : 1
          }
        },
        "description" : "Hendelse som beskriver en forsendelse"
      } ]
    },
    "forsendelseV2" : {
      "allOf" : [ {
        "$ref" : "#/definitions/MeldingMetadata"
      }, {
        "type" : "object",
        "required" : [ "avsender", "dokumenter", "lest", "mottakerAdresse", "returAdresse", "sendtDato", "tittel" ],
        "properties" : {
          "tittel" : {
            "type" : "string",
            "description" : "Tittel for meldingen"
          },
          "sendtDato" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "Dato forsendelsen er sendt. Dette feltet brukes som sorteringsdato. Uttrykket som millisekunder etter epoch"
          },
          "avsender" : {
            "type" : "string",
            "description" : "Navn på person eller orgnr / navn på organisasjon som er kilde for forsendelsen."
          },
          "returAdresse" : {
            "description" : "Returadresse påført forsendelsen",
            "$ref" : "#/definitions/ForsendelseV2Adresse"
          },
          "mottakerAdresse" : {
            "description" : "Mottakeradresse påført forsendelsen",
            "$ref" : "#/definitions/ForsendelseV2Adresse"
          },
          "lest" : {
            "type" : "boolean",
            "description" : "Indikerer om forsendelsen er lest eller ikke"
          },
          "dokumenter" : {
            "type" : "array",
            "description" : "Dokumenter som inngår i denne forsendelsen",
            "items" : {
              "$ref" : "#/definitions/ForsendelseV2Dokument"
            },
            "maxItems" : 2147483647,
            "minItems" : 1
          },
          "lenker" : {
            "type" : "array",
            "description" : "Lenker vedlagt forsendelsen",
            "items" : {
              "$ref" : "#/definitions/ForsendelseV2Lenke"
            }
          },
          "svarLenke" : {
            "type" : "string",
            "description" : "Url som skal benyttes for å svare på denne forsendelsen"
          },
          "korrelasjonId" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9\\-]+$"
          },
          "forelder" : {
            "$ref" : "#/definitions/Forelder"
          }
        },
        "description" : "Hendelse som beskriver en forsendelse"
      } ]
    },
    "journalpostV1" : {
      "allOf" : [ {
        "$ref" : "#/definitions/MeldingMetadata"
      }, {
        "type" : "object",
        "required" : [ "beskrivelse", "dokumentbeskrivelser", "journaldato", "registreringsId", "tittel" ],
        "properties" : {
          "registreringsId" : {
            "type" : "string"
          },
          "tittel" : {
            "type" : "string"
          },
          "beskrivelse" : {
            "type" : "string"
          },
          "journaldato" : {
            "type" : "integer",
            "format" : "int64"
          },
          "korrelasjonId" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9\\-]+$"
          },
          "forelder" : {
            "$ref" : "#/definitions/Forelder"
          },
          "dokumentbeskrivelser" : {
            "type" : "array",
            "items" : {
              "$ref" : "#/definitions/JournalpostV1Dokumentbeskrivelse"
            },
            "maxItems" : 2147483647,
            "minItems" : 1
          }
        }
      } ]
    },
    "matrikkelenhetV1" : {
      "allOf" : [ {
        "$ref" : "#/definitions/MeldingMetadata"
      }, {
        "type" : "object",
        "required" : [ "matrikkelenhetId", "matrikkelnummer" ],
        "properties" : {
          "matrikkelnummer" : {
            "description" : "Adresse for matrikkelenheten",
            "$ref" : "#/definitions/MatrikkelnummerV1"
          },
          "matrikkelenhetId" : {
            "type" : "integer",
            "format" : "int64",
            "description" : "Matrikkel-intern id for matrikkelenheten"
          },
          "adresser" : {
            "type" : "array",
            "example" : "Øvre Testveien 34, 3765 Storevik",
            "description" : "Adresse for matrikkelenheten",
            "items" : {
              "type" : "string"
            }
          },
          "korrelasjonId" : {
            "type" : "string",
            "pattern" : "^[A-Za-z0-9\\-]+$"
          },
          "forelder" : {
            "$ref" : "#/definitions/Forelder"
          }
        },
        "description" : "Matrikkelenhet"
      } ]
    },
    "saksmappeV1" : {
      "allOf" : [ {
        "$ref" : "#/definitions/MeldingMetadata"
      }, {
        "type" : "object",
        "required" : [ "administrativEnhet", "mappeId", "saksansvarlig", "saksdato", "saksstatus", "tittel" ],
        "properties" : {
          "mappeId" : {
            "type" : "string"
          },
          "tittel" : {
            "type" : "string"
          },
          "beskrivelse" : {
            "type" : "string"
          },
          "saksstatus" : {
            "type" : "string",
            "enum" : [ "UNDER_BEHANDLING", "AVSLUTTET", "UTGAR" ]
          },
          "saksdato" : {
            "type" : "integer",
            "format" : "int64"
          },
          "saksansvarlig" : {
            "type" : "string"
          },
          "administrativEnhet" : {
            "type" : "string"
          }
        },
        "description" : "Saksmappe"
      } ]
    }
  }
}